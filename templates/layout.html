{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}ChaiBreak | Office Social Hub{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/main.css' %}">

  {% block extra_head %}{% endblock %}
</head>

<body>
  <div class="page-container d-flex">
    
    <!-- ========== Column 1: Sidebar ========== -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <div class="logo">
          â˜•
        </div>
        <nav class="sidebar-nav">
          <a href="{% url 'index' %}" class="nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
            <i class="fa fa-home"></i> Home
          </a>
          <a href="{% url 'profile' %}" class="nav-item">
            <i class="fa fa-user"></i> Profile
          </a>
          <a href="{% url 'teams_page' %}" class="nav-item">
            <i class="fa fa-users"></i> Teams
          </a>
          <a href="#" class="nav-item">
            <i class="fa fa-bell"></i> Notifications
          </a>
          {% if user.is_authenticated %}
          <a href="{% url 'chat' user.username %}" class="nav-item">
            <i class="fa fa-envelope"></i> Messages
          </a>
          {% endif %}
          <a href="#" class="nav-item">
            <i class="fa fa-ellipsis-h"></i> More
          </a>
        </nav>

        <button class="post-btn">Post</button>
      </div>


       <div class="sidebar-bottom">
  {% if user.is_authenticated %}
    <div class="user-menu">
      <button class="user-toggle" id="userMenuToggle">
        {% if user.profile.photo %}
            <img src="{{ user.profile.photo.url }}" alt="User" class="avatar">
        {% else %}
            <img src="{% static 'images/default-avatar.png' %}" alt="User" class="avatar">
        {% endif %}

        <span class="username">{{ user.username }}</span>
        <i class="fa fa-chevron-up toggle-icon"></i>
      </button>

      <div class="dropdown-menu" id="userDropdown">
        <form method="post" action="{% url 'logout' %}" class="logout-form">
          {% csrf_token %}
          <button type="submit" class="dropdown-item">Logout</button>
        </form>
      </div>
    </div>
  {% else %}
    <div class="user-menu">
      <button class="user-toggle" id="userMenuToggle">
        <i class="fa fa-user-circle fa-lg"></i>
        <span class="username">Guest</span>
        <i class="fa fa-chevron-up toggle-icon"></i>
      </button>

      <div class="dropdown-menu" id="userDropdown">
        <a href="{% url 'login' %}" class="dropdown-item">Login</a>
        <a href="{% url 'register' %}" class="dropdown-item">Register</a>
      </div>
    </div>
  {% endif %}

  <button id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
</div>

  </aside>

    <!-- ========== Column 2: Main Feed ========== -->
    <main class="main-feed flex-grow-1 p-3">
      {% block content %}{% endblock %}
    </main>

    <!-- ========== Column 3: Right Sidebar ========== -->
    <aside class="rightbar p-3">
      {% block right_sidebar %}
        <div class="card p-3 mb-3">
          <h5>ğŸ“¢ Company News</h5>
          <ul class="list-unstyled small">
            <li>ğŸ‰ New cafeteria opens next week!</li>
            <li>ğŸ“… Monthly Townhall on Monday.</li>
            <li>ğŸ† Top performer: Riya Sharma</li>
          </ul>
        </div>

        <div class="card p-3">
          <h5>ğŸ‘¥ Active Teams</h5>
          <ul class="list-unstyled small">
            <li>Marketing Squad</li>
            <li>DevOps Ninjas</li>
            <li>Content Crew</li>
          </ul>
        </div>
      {% endblock %}
    </aside>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const body = document.body;
    const toggle = document.getElementById('theme-toggle');
    const dark = localStorage.getItem('darkMode');
    if (dark === 'true') {
      body.classList.add('dark');
      toggle.textContent = 'â˜€ï¸';
    }
    toggle.addEventListener('click', () => {
      body.classList.toggle('dark');
      const isDark = body.classList.contains('dark');
      toggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('darkMode', isDark);
    });
  </script>
  <script>
  const userToggle = document.getElementById('userMenuToggle');
  const userDropdown = document.getElementById('userDropdown');
  const userMenu = document.querySelector('.user-menu');

  if (userToggle && userDropdown) {
    userToggle.addEventListener('click', () => {
      userMenu.classList.toggle('open');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userMenu.contains(e.target)) {
        userMenu.classList.remove('open');
      }
    });
  }
</script>
</body>
</html>
